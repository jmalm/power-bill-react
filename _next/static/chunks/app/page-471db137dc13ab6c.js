(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3532:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(5155),a=r(2115);function l(e){let{selectedModel:t,onModelChange:r,priceModels:a}=e;return(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("select",{id:"price-model-select",value:t,onChange:e=>r(e.target.value),className:"block w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-white focus:ring-blue-500 focus:border-blue-500",children:a.map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.name))})})}function n(e){var t;let{tariff:r,onChange:a}=e,l=e=>{let{name:t,value:s,type:l,checked:n}=e.target,i=s;"number"===l&&(i=parseFloat(s)),"checkbox"===l&&(i=n),a({...r,[t]:i})};return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Tariff name"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"name",value:r.name,onChange:l})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Fee per kW"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"feePerKW",type:"number",value:r.feePerKW,onChange:l})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Number of top peaks to average"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"numberOfTopPeaksToAverage",type:"number",value:r.numberOfTopPeaksToAverage,onChange:l})]}),(0,s.jsx)("h4",{className:"text-md font-semibold mt-2",children:"Time limits (optional)"}),r.timeLimits?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Start time"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"startTime",type:"time",value:r.timeLimits.startTime,onChange:e=>{a({...r,timeLimits:{...r.timeLimits,startTime:e.target.value}})}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"End time"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"endTime",type:"time",value:r.timeLimits.endTime,onChange:e=>{a({...r,timeLimits:{...r.timeLimits,endTime:e.target.value}})}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Months (1 - 12, comma-separated)"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"months",value:null==(t=r.timeLimits.months)?void 0:t.join(","),onChange:e=>{let t=e.target.value.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e));a({...r,timeLimits:{...r.timeLimits,months:t}})}})]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>a({...r,timeLimits:void 0}),className:"mt-2 bg-gray-200 p-2 rounded hover:bg-red-600 hover:text-white",children:"Remove time limits"})]}):(0,s.jsx)("button",{type:"button",onClick:()=>a({...r,timeLimits:{startTime:"00:00",endTime:"23:59",months:[]}}),className:"mt-2 bg-gray-200 p-2 rounded hover:bg-green-600 hover:text-white",children:"Add time limits"}),(0,s.jsx)("h4",{className:"text-md font-semibold mt-2",children:"Night reduction (optional)"}),r.reduction?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Reduction factor"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"nightReduction.factor",type:"number",step:"0.01",value:r.reduction.factor,onChange:e=>{let t=parseFloat(e.target.value);a({...r,reduction:{...r.reduction,factor:isNaN(t)?0:t}})}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Reduction start time"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"nightReduction.startTime",type:"time",value:r.reduction.startTime,onChange:e=>{a({...r,reduction:{...r.reduction,startTime:e.target.value}})}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Reduction end time"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"nightReduction.endTime",type:"time",value:r.reduction.endTime,onChange:e=>{a({...r,reduction:{...r.reduction,endTime:e.target.value}})}})]}),(0,s.jsx)("button",{type:"button",onClick:()=>a({...r,reduction:void 0}),className:"mt-2 bg-gray-200 hover:bg-red-600 hover:text-white p-2 rounded",children:"Remove night reduction"})]}):(0,s.jsx)("button",{type:"button",onClick:()=>a({...r,reduction:{factor:.5,startTime:"22:00",endTime:"08:00"}}),className:"mt-2 bg-gray-200 hover:bg-green-600 hover:text-white p-2 rounded",children:"Add night reduction"})]})}class i{constructor(e,t,r=2,s=[],a="00:00",l="23:59",n){this.name=e,this.feePerKW=t,this.numberOfTopPeaksToAverage=r,this.months=s,this.startTime=a,this.endTime=l,this.reduction=n}}function o(e){let{model:t,onChange:r}=e,a=e=>{let{name:s,value:a,type:l,checked:n}=e.target,i=a;"number"===l&&(i=parseFloat(a)),"checkbox"===l&&(i=n),r({...t,[s]:i})};return(0,s.jsxs)("form",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Name"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"name",value:t.name,onChange:a})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Currency"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"currency",value:t.currency,onChange:a})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Usage tax per kWh"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"usageTaxPerKWh",type:"number",value:t.usageTaxPerKWh,onChange:a})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"VAT rate"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"vatRate",type:"number",value:t.vatRate,onChange:a})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"text-sm flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",name:"pricesIncludeVat",checked:t.pricesIncludeVat,onChange:a,className:"mr-2"}),"Prices include VAT"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Fixed fee per month"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"fixedFeePerMonth",type:"number",value:t.fixedFeePerMonth,onChange:a})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm",children:"Usage fee per kWh"}),(0,s.jsx)("input",{className:"block w-full p-2 border rounded",name:"usageFeePerKWh",type:"number",value:t.usageFeePerKWh,onChange:a})]})," ",(0,s.jsx)("h3",{className:"text-lg font-semibold mt-4",children:"Power tariffs"}),t.powerTariffs.map((e,a)=>(0,s.jsxs)("div",{className:"border p-2 rounded mt-2",children:[(0,s.jsx)(n,{tariff:e,onChange:e=>{let s=[...t.powerTariffs];s[a]=e,r({...t,powerTariffs:s})}}),(0,s.jsx)("button",{type:"button",onClick:()=>{let e=t.powerTariffs.filter((e,t)=>t!==a);r({...t,powerTariffs:e})},className:"mt-2 bg-gray-200 p-2 rounded hover:bg-red-600 hover:text-white",children:"Remove tariff"})]},a)),(0,s.jsx)("button",{type:"button",onClick:()=>{let e=[...t.powerTariffs,new i("New tariff",0)];r({...t,powerTariffs:e})},className:"mt-4 bg-gray-200 p-2 rounded hover:bg-green-600 hover:text-white",children:"New tariff"})]})}function c(e){var t,r;return{name:e.name,feePerKW:e.fee_per_kw,numberOfTopPeaksToAverage:e.number_of_top_peaks_to_average,timeLimits:e.time_limits?{startTime:(t=e.time_limits).start_time,endTime:t.end_time,months:t.months}:void 0,reduction:e.reduction?{startTime:(r=e.reduction).start_time,endTime:r.end_time,factor:r.factor}:void 0}}async function d(){let e="/power-bill-react",t=await fetch("".concat(e,"/price-models/models-index.json")),r=(await t.json()).models;return await Promise.all(r.map(async t=>{var r,s;let a=await fetch("".concat(e,"/price-models/").concat(t));return{name:(r=await a.json()).name,currency:r.currency,vatRate:r.vat_rate,pricesIncludeVat:r.prices_include_tax,fixedFeePerMonth:r.fixed_fee_per_month,usageFeePerKWh:r.usage_fee_per_kwh,usageTaxPerKWh:r.usage_tax_per_kwh,powerTariffs:(null==(s=r.power_tariffs)?void 0:s.map(c))||[]}}))}function m(e){let{model:t,totalUsage:r,topHours:a}=e,l=t.pricesIncludeVat?1/(1+t.vatRate):1,n=t.fixedFeePerMonth*l,i=r*t.usageFeePerKWh*l,o=t.powerTariffs.map(e=>{let t=a[e.name]||0,r=t*e.feePerKW*l;return{name:e.name,avgTop:t,fee:r,feePerKW:e.feePerKW,n:e.numberOfTopPeaksToAverage}}),c=r*t.usageTaxPerKWh*l,d=n+i+o.reduce((e,t)=>e+t.fee,0)+c,m=d*t.vatRate,u=d+m;return(0,s.jsxs)("div",{className:"mt-8 md:p-4 md:bg-white md:rounded md:shadow text-gray-900",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Cost Breakdown"}),(0,s.jsx)("table",{className:"w-full text-left table-auto",children:(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsx)("td",{className:"py-1",children:"Fixed fee"}),(0,s.jsxs)("td",{className:"py-1 text-right",children:[n.toFixed(2),"\xa0",t.currency]})]}),(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsxs)("td",{className:"py-1",children:["Usage fee (",r.toFixed(2),"\xa0kWh \xd7"," ",(t.usageFeePerKWh*l).toFixed(2),"\xa0",t.currency,"\xa0/\xa0kWh)"]}),(0,s.jsxs)("td",{className:"py-1 text-right",children:[i.toFixed(2),"\xa0",t.currency]})]}),o.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsxs)("td",{className:"py-1",children:[e.name," (",e.avgTop.toFixed(2),"\xa0kW \xd7"," ",(e.feePerKW*l).toFixed(2),"\xa0",t.currency,"\xa0/\xa0kW)"]}),(0,s.jsxs)("td",{className:"py-1 text-right",children:[e.fee.toFixed(2),"\xa0",t.currency]})]},e.name)),(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsxs)("td",{className:"py-1",children:["Electricity tax (",r.toFixed(2),"\xa0kWh \xd7"," ",(t.usageTaxPerKWh*l).toFixed(2),"\xa0",t.currency,"\xa0/\xa0kWh)"]}),(0,s.jsxs)("td",{className:"py-1 text-right",children:[c.toFixed(2),"\xa0",t.currency]})]}),(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsxs)("td",{className:"py-1",children:["VAT (",(100*t.vatRate).toFixed(1),"%)"]}),(0,s.jsxs)("td",{className:"py-1 text-right",children:[m.toFixed(2),"\xa0",t.currency]})]}),(0,s.jsxs)("tr",{className:"font-bold text-lg",children:[(0,s.jsx)("td",{className:"py-2",children:"Total"}),(0,s.jsxs)("td",{className:"py-2 text-right",children:[u.toFixed(2),"\xa0",t.currency]})]})]})})]})}function u(e){if(!e)return;let[t,r]=e.split(":").map(Number);return t+(r||0)/60}function h(){let[e,t]=(0,a.useState)("custom"),[r,n]=(0,a.useState)([]),i=r.find(t=>t.name===e)||null,[c,h]=(0,a.useState)(null),[x,b]=(0,a.useState)(!1),[f,p]=(0,a.useState)([]);(0,a.useEffect)(()=>{d().then(r=>{n(r),r.length>0&&!r.some(t=>t.name===e)&&t(r[0].name)})},[]),(0,a.useEffect)(()=>{h(i?{...i}:null)},[i]);let g=f.reduce((e,t)=>e+t.usage,0),j=i&&f.length?function(e,t){if(!e.length)return{};let r=function(e){let t={};return e.forEach(e=>{let{datetime:r,usage:s}=e,a=new Date(r);if(isNaN(a.getTime()))return;let l=a.toISOString().slice(0,10),n=a.getHours();t[l]||(t[l]={}),t[l][n]=(t[l][n]||0)+s}),t}(e),s={};for(let e of t.powerTariffs){let t=function(e,t){let r=[...e].sort((e,t)=>t-e).slice(0,t);return 0===r.length?0:r.reduce((e,t)=>e+t,0)/r.length}(function(e,t){let r=[];for(let s in e){if(!function(e,t){var r;return null==(r=t.timeLimits)||!r.months||0===t.timeLimits.months.length||t.timeLimits.months.includes(e.getMonth()+1)}(new Date(s),t))continue;let a=function(e,t,r){let s=-1/0;for(let t=0;t<24;t++){if(!function(e,t){var r,s;if(!t.timeLimits||!t.timeLimits.startTime||!t.timeLimits.endTime)return!0;let a=null!=(r=u(t.timeLimits.startTime))?r:0,l=null!=(s=u(t.timeLimits.endTime))?s:24;return a<l?e>=a&&e<l:e>=a||e<l}(t,r))continue;let a=e[t]||0;r.reduction&&function(e,t){if(!t)return!1;let r=u(t.startTime),s=u(t.endTime);return void 0!==r&&void 0!==s&&(r<=s?e>=r&&e<s:e>=r||e<s)}(t,r.reduction)&&(a*=r.reduction.factor),a>s&&(s=a)}return s>-1/0?s:0}(e[s],0,t);r.push(a)}return r}(r,e),e.numberOfTopPeaksToAverage);s[e.name]=t}return s}(f,i):{};return(0,s.jsxs)("main",{className:"flex min-h-screen flex-col items-center p-4 md:p-24 w-full",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"Calculate Electricity Cost"}),(0,s.jsxs)("div",{className:"grid grid-cols-[minmax(0,40rem)] xl:grid-cols-[minmax(18rem,18rem)_minmax(30rem,40rem)_minmax(18rem,18rem)] gap-8 justify-center w-full max-w-8xl mx-auto",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-lg",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Price Model"}),(0,s.jsx)(l,{selectedModel:e,onModelChange:t,priceModels:r}),(0,s.jsx)("button",{className:"mt-4 px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors",onClick:()=>b(e=>!e),children:x?"Hide Details":"Show Details"}),x&&c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o,{model:c,onChange:e=>{h(e),n(t=>t.map(t=>t.name===e.name?e:t))}}),(0,s.jsx)("button",{className:"mt-4 w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors",onClick:()=>(function(e,t){let r=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download=t,a.click(),URL.revokeObjectURL(s)})(c,"".concat(c.name||"price-model",".json")),children:"Download as JSON"})]})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-lg",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Usage Data"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block mb-2 font-medium",children:"Upload usage CSV"}),(0,s.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>(function(e,t){var r;let s=null==(r=e.target.files)?void 0:r[0];if(!s)return;let a=new FileReader;a.onload=e=>{var r;t(function(e){let t=e.split(/\r?\n/),r=[];for(let e of t){if(!e.trim())continue;let t=e.match(/^([^;]+);([\d.,]*)$/);if(t){let e=t[2].replace(",",".");r.push({datetime:t[1],usage:parseFloat(e||"0")})}}return r}(null==(r=e.target)?void 0:r.result))},a.readAsText(s)})(e,p),className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),f.length>0&&(0,s.jsxs)("div",{className:"mt-2 text-sm text-green-400",children:["Loaded ",f.length," usage rows. Total:"," ",g.toFixed(2)," kWh"]})]}),i&&(0,s.jsx)(m,{model:i,totalUsage:g,topHours:j})]})}),(0,s.jsx)("div",{className:"text-gray-400",children:(0,s.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-lg",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"How to Use"}),(0,s.jsx)("p",{className:"mb-4",children:"1. Select a predefined price model or customize your own."}),(0,s.jsx)("p",{className:"mb-4",children:"2. Upload a CSV file containing your electricity usage data. The CSV should have two columns: `timestamp` (e.g., YYYY-MM-DD HH:MM:SS) and `usage` (in kWh)."}),(0,s.jsx)("p",{className:"",children:"3. The cost breakdown will automatically update based on your selected price model and uploaded usage data."}),(0,s.jsx)("h2",{className:"text-xl font-semibold mt-6 mb-4",children:"Contribute Your Price Model"}),(0,s.jsx)("p",{className:"mt-4",children:'If you don\'t find a suitable price model, you can create a new one using the editor. Click "Show Details" to access the editor. Please consider sharing your model, for others to use, by'}),(0,s.jsxs)("ol",{className:"list-decimal list-inside mt-2",children:[(0,s.jsx)("li",{children:"Downloading it as a JSON file."}),(0,s.jsxs)("li",{children:["Uploading it to ",(0,s.jsx)("a",{href:"https://github.com/jmalm/power-bill-react/issues/1",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Contributed price models on GitHub"}),"."]})]})]})})]}),(0,s.jsx)("footer",{className:"w-full text-center mt-12 p-4 text-gray-500 text-sm",children:(0,s.jsxs)("p",{children:["\xa9 2025"," ",(0,s.jsx)("a",{href:"https://github.com/jmalm",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Jakob Malm"})]})})]})}},6819:(e,t,r)=>{Promise.resolve().then(r.bind(r,3532))}},e=>{e.O(0,[441,964,358],()=>e(e.s=6819)),_N_E=e.O()}]);