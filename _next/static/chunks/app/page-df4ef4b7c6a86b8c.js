(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{193:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var l=s(5155),a=s(2115);function n(e){let{selectedModel:t,onModelChange:s,priceModels:a}=e;return(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)("select",{id:"price-model-select",value:t,onChange:e=>s(e.target.value),className:"block w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-white focus:ring-blue-500 focus:border-blue-500",children:a.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.name))})})}function r(e){var t;let{tariff:s,onChange:a}=e,n=e=>{let{name:t,value:l,type:n,checked:r}=e.target,i=l;"number"===n&&(i=parseFloat(l)),"checkbox"===n&&(i=r),a({...s,[t]:i})};return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Tariff name"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"name",value:s.name,onChange:n})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Fee per kW"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"feePerKW",type:"number",value:s.feePerKW,onChange:n})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Number of top peaks to average"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"numberOfTopPeaksToAverage",type:"number",value:s.numberOfTopPeaksToAverage,onChange:n})]}),(0,l.jsx)("h4",{className:"text-md font-semibold mt-2",children:"Time limits (optional)"}),s.timeLimits?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Start time"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"startTime",type:"time",value:s.timeLimits.startTime,onChange:e=>{a({...s,timeLimits:{...s.timeLimits,startTime:e.target.value}})}})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"End time"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"endTime",type:"time",value:s.timeLimits.endTime,onChange:e=>{a({...s,timeLimits:{...s.timeLimits,endTime:e.target.value}})}}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Months (1 - 12, comma-separated)"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"months",value:null==(t=s.timeLimits.months)?void 0:t.join(","),onChange:e=>{let t=e.target.value.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e));a({...s,timeLimits:{...s.timeLimits,months:t}})}})]})]}),(0,l.jsx)("button",{type:"button",onClick:()=>a({...s,timeLimits:void 0}),className:"mt-2 bg-gray-200 p-2 rounded hover:bg-red-600 hover:text-white",children:"Remove time limits"})]}):(0,l.jsx)("button",{type:"button",onClick:()=>a({...s,timeLimits:{startTime:"00:00",endTime:"23:59",months:[]}}),className:"mt-2 bg-gray-200 p-2 rounded hover:bg-green-600 hover:text-white",children:"Add time limits"}),(0,l.jsx)("h4",{className:"text-md font-semibold mt-2",children:"Night reduction (optional)"}),s.reduction?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Reduction factor"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"nightReduction.factor",type:"number",step:"0.01",value:s.reduction.factor,onChange:e=>{let t=parseFloat(e.target.value);a({...s,reduction:{...s.reduction,factor:isNaN(t)?0:t}})}})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Reduction start time"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"nightReduction.startTime",type:"time",value:s.reduction.startTime,onChange:e=>{a({...s,reduction:{...s.reduction,startTime:e.target.value}})}})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Reduction end time"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"nightReduction.endTime",type:"time",value:s.reduction.endTime,onChange:e=>{a({...s,reduction:{...s.reduction,endTime:e.target.value}})}})]}),(0,l.jsx)("button",{type:"button",onClick:()=>a({...s,reduction:void 0}),className:"mt-2 bg-gray-200 hover:bg-red-600 hover:text-white p-2 rounded",children:"Remove night reduction"})]}):(0,l.jsx)("button",{type:"button",onClick:()=>a({...s,reduction:{factor:.5,startTime:"22:00",endTime:"08:00"}}),className:"mt-2 bg-gray-200 hover:bg-green-600 hover:text-white p-2 rounded",children:"Add night reduction"})]})}function i(e){var t;let{usageFee:s,onChange:a}=e,n=e=>{let{name:t,value:l,type:n,checked:r}=e.target,i=l;"number"===n&&(i=parseFloat(l)),"checkbox"===n&&(i=r),a({...s,[t]:i})};return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Fee name"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"name",value:s.name,onChange:n})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Fee per kWh"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"feePerKW",type:"number",value:s.feePerKW,onChange:n})]}),s.timeLimits?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Start time"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"startTime",type:"time",value:s.timeLimits.startTime,onChange:e=>{a({...s,timeLimits:{...s.timeLimits,startTime:e.target.value}})}})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"End time"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"endTime",type:"time",value:s.timeLimits.endTime,onChange:e=>{a({...s,timeLimits:{...s.timeLimits,endTime:e.target.value}})}}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Months (1 - 12, comma-separated)"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"months",value:null==(t=s.timeLimits.months)?void 0:t.join(","),onChange:e=>{let t=e.target.value.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e));a({...s,timeLimits:{...s.timeLimits,months:t}})}})]})]}),(0,l.jsx)("button",{type:"button",onClick:()=>a({...s,timeLimits:void 0}),className:"mt-2 bg-gray-200 p-2 rounded hover:bg-red-600 hover:text-white",children:"Remove time limits"})]}):(0,l.jsx)("button",{type:"button",onClick:()=>a({...s,timeLimits:{startTime:"00:00",endTime:"23:59",months:[]}}),className:"mt-2 bg-gray-200 p-2 rounded hover:bg-green-600 hover:text-white",children:"Add time limits"})]})}class o{constructor(e,t,s=2,l=[],a="00:00",n="23:59",r){this.name=e,this.feePerKW=t,this.numberOfTopPeaksToAverage=s,this.months=l,this.startTime=a,this.endTime=n,this.reduction=r}}function c(e){let{model:t,onChange:s}=e,a=e=>{let{name:l,value:a,type:n,checked:r}=e.target,i=a;"number"===n&&(i=parseFloat(a)),"checkbox"===n&&(i=r),s({...t,[l]:i})};return(0,l.jsxs)("form",{className:"space-y-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Name"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"name",value:t.name,onChange:a})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Currency"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"currency",value:t.currency,onChange:a})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"VAT rate"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"vatRate",type:"number",value:t.vatRate,onChange:a})]}),(0,l.jsx)("div",{children:(0,l.jsxs)("label",{className:"text-sm flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",name:"pricesIncludeVat",checked:t.pricesIncludeVat,onChange:a,className:"mr-2"}),"Prices include VAT"]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Fixed fee per month"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"fixedFeePerMonth",type:"number",value:t.fixedFeePerMonth,onChange:a})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm",children:"Source URL (optional)"}),(0,l.jsx)("input",{className:"block w-full p-2 bg-white rounded",name:"url",type:"url",placeholder:"https://example.com/pricing",value:t.url||"",onChange:a})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold mt-4",children:"Usage fees"}),t.usageFees.map((e,a)=>(0,l.jsxs)("div",{className:"bg-gray-100 p-4 rounded mt-2",children:[(0,l.jsx)(i,{usageFee:e,onChange:e=>{let l=[...t.usageFees];l[a]=e,s({...t,usageFees:l})}}),(0,l.jsx)("button",{type:"button",onClick:()=>{let e=[...t.usageFees];e.splice(a,1),s({...t,usageFees:e})},className:"mt-2 bg-red-600 text-white p-2 rounded hover:bg-red-700",children:"Remove Fee"})]},a)),(0,l.jsx)("button",{type:"button",onClick:()=>s({...t,usageFees:[...t.usageFees,{name:"",feePerKW:0,timeLimits:void 0}]}),className:"mt-2 bg-green-600 text-white p-2 rounded hover:bg-green-700",children:"Add Usage Fee"})," ",(0,l.jsx)("h3",{className:"text-lg font-semibold mt-4",children:"Power tariffs"}),t.powerTariffs.map((e,a)=>(0,l.jsxs)("div",{className:"bg-gray-100 p-4 rounded mt-2",children:[(0,l.jsx)(r,{tariff:e,onChange:e=>{let l=[...t.powerTariffs];l[a]=e,s({...t,powerTariffs:l})}}),(0,l.jsx)("button",{type:"button",onClick:()=>{let e=t.powerTariffs.filter((e,t)=>t!==a);s({...t,powerTariffs:e})},className:"mt-2 bg-gray-200 p-2 rounded hover:bg-red-600 hover:text-white",children:"Remove tariff"})]},a)),(0,l.jsx)("button",{type:"button",onClick:()=>{let e=[...t.powerTariffs,new o("New tariff",0)];s({...t,powerTariffs:e})},className:"mt-4 bg-gray-200 p-2 rounded hover:bg-green-600 hover:text-white",children:"New tariff"})]})}function m(e){return{name:e.name,feePerKW:e.fee_per_kw,timeLimits:e.time_limits?u(e.time_limits):void 0}}function d(e){var t;return{name:e.name,feePerKW:e.fee_per_kw,numberOfTopPeaksToAverage:e.number_of_top_peaks_to_average,timeLimits:e.time_limits?u(e.time_limits):void 0,reduction:e.reduction?{startTime:(t=e.reduction).start_time,endTime:t.end_time,factor:t.factor}:void 0}}function u(e){return{startTime:e.start_time,endTime:e.end_time,months:e.months}}async function h(){let e="/power-bill-react",t=await fetch("".concat(e,"/price-models/models-index.json")),s=(await t.json()).models;return await Promise.all(s.map(async t=>{var s,l,a;let n=await fetch("".concat(e,"/price-models/").concat(t));return{name:(s=await n.json()).name,currency:s.currency,vatRate:s.vat_rate,pricesIncludeVat:s.prices_include_tax,fixedFeePerMonth:s.fixed_fee_per_month,usageFees:(null==(l=s.usage_fees)?void 0:l.map(m))||[],powerTariffs:(null==(a=s.power_tariffs)?void 0:a.map(d))||[],url:s.url||void 0}}))}function x(e){let{model:t,totalUsagePerFee:s,topHoursPerTariff:a}=e,n=t.pricesIncludeVat?1/(1+t.vatRate):1,r=t.fixedFeePerMonth*n,i=t.usageFees.map(e=>{let t=e.feePerKW*n,l=s[e.name]||0;return{name:e.name,fee:l*t,feePerKW:t,totalUsage:l,timeLimits:e.timeLimits}}),o=t.powerTariffs.map(e=>{let t=a[e.name]||0,s=t*e.feePerKW*n;return{name:e.name,avgTop:t,fee:s,feePerKW:e.feePerKW,n:e.numberOfTopPeaksToAverage}}),c=r+i.reduce((e,t)=>e+t.fee,0)+o.reduce((e,t)=>e+t.fee,0),m=c*t.vatRate,d=c+m;return(0,l.jsxs)("div",{className:"w-full text-gray-900",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Cost Breakdown"}),(0,l.jsx)("table",{className:"w-full text-left table-auto",children:(0,l.jsxs)("tbody",{children:[(0,l.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,l.jsx)("td",{className:"py-1",children:"Fixed fee"}),(0,l.jsxs)("td",{className:"py-1 text-right",children:[r.toFixed(2),"\xa0",t.currency]})]}),i.map(e=>e.totalUsage>0&&(0,l.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,l.jsxs)("td",{className:"py-1",children:[e.name," (",e.totalUsage.toFixed(2),"\xa0kWh \xd7"," ",e.feePerKW.toFixed(2),"\xa0",t.currency,"\xa0/\xa0kWh)"]}),(0,l.jsxs)("td",{className:"py-1 text-right",children:[e.fee.toFixed(2),"\xa0",t.currency]})]},e.name)),o.map(e=>e.avgTop>0&&(0,l.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,l.jsxs)("td",{className:"py-1",children:[e.name," (",e.avgTop.toFixed(2),"\xa0kW \xd7"," ",(e.feePerKW*n).toFixed(2),"\xa0",t.currency,"\xa0/\xa0kW)"]}),(0,l.jsxs)("td",{className:"py-1 text-right",children:[e.fee.toFixed(2),"\xa0",t.currency]})]},e.name)),(0,l.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,l.jsxs)("td",{className:"py-1",children:["VAT (",(100*t.vatRate).toFixed(1),"%)"]}),(0,l.jsxs)("td",{className:"py-1 text-right",children:[m.toFixed(2),"\xa0",t.currency]})]}),(0,l.jsxs)("tr",{className:"font-bold text-lg",children:[(0,l.jsx)("td",{className:"py-2",children:"Total"}),(0,l.jsxs)("td",{className:"py-2 text-right",children:[d.toFixed(2),"\xa0",t.currency]})]})]})})]})}let b=a.forwardRef(function(e,t){let{title:s,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),s?a.createElement("title",{id:l},s):null,a.createElement("path",{fillRule:"evenodd",d:"M9.47 6.47a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 1 1-1.06 1.06L10 8.06l-3.72 3.72a.75.75 0 0 1-1.06-1.06l4.25-4.25Z",clipRule:"evenodd"}))}),p=a.forwardRef(function(e,t){let{title:s,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),s?a.createElement("title",{id:l},s):null,a.createElement("path",{fillRule:"evenodd",d:"M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))});function f(e){let{content:t,maxLines:s=10}=e,[n,r]=(0,a.useState)(!1),i=t.split("\n"),o=n?i:i.slice(0,s),c=i.length>s;return(0,l.jsxs)("div",{className:"mt-4 border rounded-md overflow-hidden",children:[(0,l.jsx)("div",{className:"bg-gray-50 px-4 py-2 text-xs font-mono text-gray-500 border-b",children:"File content preview"}),(0,l.jsx)("div",{className:"bg-white p-2 overflow-auto max-h-96",children:(0,l.jsxs)("pre",{className:"text-xs font-mono text-gray-800",children:[o.map((e,t)=>(0,l.jsxs)("div",{className:"whitespace-pre-wrap",children:[(0,l.jsx)("span",{className:"text-gray-400 select-none mr-2 w-6 inline-block text-right",children:t+1}),e||" "]},t)),!n&&c&&(0,l.jsxs)("div",{className:"text-center text-xs text-gray-500 py-1",children:["... ",i.length-s," more lines"]})]})}),c&&(0,l.jsx)("button",{onClick:()=>r(!n),className:"w-full py-1 text-xs text-center text-blue-600 hover:bg-gray-50 border-t flex items-center justify-center gap-1",children:n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b,{className:"h-4 w-4"}),"Show less"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p,{className:"h-4 w-4"}),"Show more"]})})]})}function g(e){let{setUsageData:t,usageData:n,disabled:r=!1}=e,[i,o]=(0,a.useState)(null),[c,m]=(0,a.useState)(!1),[d,u]=(0,a.useState)(null),[h,x]=(0,a.useState)(""),[b,p]=(0,a.useState)(!1),g=async e=>{var l;let a=null==(l=e.target.files)?void 0:l[0];if(a){m(!0),o(null),u(a.name),p(!1);try{let e=await a.text();x(e);try{let{parseUsageCsv:l}=await s.e(552).then(s.bind(s,552)),a=l(e);if(a.length<2)throw Error("CSV must contain at least 2 data points");t(a)}catch(e){console.error("Error parsing CSV:",e),o(e instanceof Error?e.message:"Failed to parse CSV file"),t([])}}catch(e){console.error("Error reading file:",e),o(e instanceof Error?e.message:"Failed to read file"),t([])}finally{m(!1),e.target.value=""}}};return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("label",{className:"cursor-pointer",children:[(0,l.jsx)("span",{className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Choose File"}),(0,l.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:g,disabled:r||c,className:"hidden"})]}),(0,l.jsx)("span",{className:"text-sm text-gray-700 truncate max-w-xs",children:d||"No file chosen"})]}),c&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-50",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})})]}),i&&(0,l.jsx)("div",{className:"mt-2 p-3 text-sm text-red-700 bg-red-50 rounded-md border border-red-200",children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"font-medium",children:["Error processing ",d||"file",":"]}),(0,l.jsx)("div",{className:"mt-1",children:i})]}),(0,l.jsx)("button",{onClick:()=>{o(null),u(null),t([]),x("")},className:"ml-4 text-red-700 hover:text-red-900 focus:outline-none","aria-label":"Dismiss error",children:"✕"})]})}),d&&!c&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsxs)("div",{className:"text-sm text-green-700 mb-2",children:["Successfully loaded ",null==n?void 0:n.length," data points"]}),(0,l.jsxs)("button",{onClick:()=>p(!b),className:"text-xs text-blue-600 hover:text-blue-800 focus:outline-none",children:[b?"Hide":"Show"," raw file content"]}),b&&h&&(0,l.jsx)(f,{content:h})]})]})}function j(e){if(!e)return;let[t,s]=e.split(":").map(Number);return t+(s||0)/60}function v(e,t){return null==t||!t.months||0===t.months.length||t.months.includes(e.getMonth()+1)}function N(e,t){var s,l;if(!t||!t.startTime||!t.endTime)return!0;let a=null!=(s=j(t.startTime))?s:0,n=null!=(l=j(t.endTime))?l:24;return a<n?e>=a&&e<n:e>=a||e<n}function w(){let[e,t]=(0,a.useState)("custom"),[s,r]=(0,a.useState)([]),i=s.find(t=>t.name===e)||null,[o,m]=(0,a.useState)(null),[d,u]=(0,a.useState)(!1),[b,p]=(0,a.useState)([]);(0,a.useEffect)(()=>{h().then(s=>{r(s),s.length>0&&!s.some(t=>t.name===e)&&t(s[0].name)})},[]),(0,a.useEffect)(()=>{m(i?{...i}:null)},[i]),b.reduce((e,t)=>e+t.usage,0);let f=i&&b.length?function(e,t){let s={};for(let n of t.usageFees)for(let t of(s[n.name]=0,e)){var l,a;l=new Date(t.datetime),(!(a=n.timeLimits)||v(l,a)&&N(l.getHours(),a))&&(s[n.name]+=t.usage)}return s}(b,i):{},w=i&&b.length?function(e,t){if(!e.length)return{};let s=function(e){let t={};return e.forEach(e=>{let{datetime:s,usage:l}=e,a=new Date(s);if(isNaN(a.getTime()))return;let n=a.toISOString().slice(0,10),r=a.getHours();t[n]||(t[n]={}),t[n][r]=(t[n][r]||0)+l}),t}(e),l={};for(let e of t.powerTariffs){let t=function(e,t){let s=[...e].sort((e,t)=>t-e).slice(0,t);return 0===s.length?0:s.reduce((e,t)=>e+t,0)/s.length}(function(e,t){let s=[];for(let l in e){if(!v(new Date(l),t.timeLimits))continue;let a=function(e,t,s){let l=-1/0;for(let t=0;t<24;t++){if(!N(t,s.timeLimits))continue;let a=e[t]||0;s.reduction&&function(e,t){if(!t)return!1;let s=j(t.startTime),l=j(t.endTime);return void 0!==s&&void 0!==l&&(s<=l?e>=s&&e<l:e>=s||e<l)}(t,s.reduction)&&(a*=s.reduction.factor),a>l&&(l=a)}return l>-1/0?l:0}(e[l],0,t);s.push(a)}return s}(s,e),e.numberOfTopPeaksToAverage);l[e.name]=t}return l}(b,i):{};return(0,l.jsxs)("main",{className:"flex min-h-screen flex-col items-center p-4 md:p-24 w-full",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"Calculate Electricity Cost"}),(0,l.jsxs)("div",{className:"grid grid-cols-[minmax(0,40rem)] xl:grid-cols-[minmax(18rem,18rem)_minmax(30rem,40rem)_minmax(18rem,18rem)] gap-8 justify-center w-full max-w-8xl mx-auto",children:[(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-lg",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Price Model"}),(0,l.jsx)(n,{selectedModel:e,onModelChange:t,priceModels:s}),(0,l.jsx)("button",{className:"mt-4 px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors",onClick:()=>u(e=>!e),children:d?"Hide Details":"Show Details"}),d&&o&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c,{model:o,onChange:e=>{m(e),r(t=>t.map(t=>t.name===e.name?e:t))}}),(0,l.jsx)("button",{className:"mt-4 w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors",onClick:()=>(function(e,t){let s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=URL.createObjectURL(s),a=document.createElement("a");a.href=l,a.download=t,a.click(),URL.revokeObjectURL(l)})(o,"".concat(o.name||"price-model",".json")),children:"Download as JSON"})]})]})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-lg",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Usage Data"}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(g,{setUsageData:p,usageData:b})})]}),i&&b.length>0&&(0,l.jsx)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-lg mt-8",children:(0,l.jsx)(x,{model:i,totalUsagePerFee:f,topHoursPerTariff:w})})]}),(0,l.jsx)("div",{className:"text-gray-400",children:(0,l.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-lg",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"How to Use"}),(0,l.jsx)("p",{className:"mb-4",children:"1. Select a predefined price model or customize your own."}),(0,l.jsxs)("p",{className:"mb-4",children:["2. Upload a CSV file containing your electricity usage data. The CSV should contain electricity usage ",(0,l.jsx)("em",{children:"per hour"}),", and have two columns:"," ",(0,l.jsx)("span",{style:{fontFamily:"monospace"},children:"timestamp"})," ","(the start of the hour, in YYYY-MM-DD HH:MM format), and"," ",(0,l.jsx)("span",{style:{fontFamily:"monospace"},children:"usage"})," ","(electricity usage during the following hour, in kWh)."]}),(0,l.jsx)("p",{className:"",children:"3. The cost breakdown will automatically update based on your selected price model and uploaded usage data."}),(0,l.jsx)("h2",{className:"text-xl font-semibold mt-6 mb-4",children:"Contribute Your Price Model"}),(0,l.jsx)("p",{className:"mt-4",children:'If you don\'t find a suitable price model, you can create a new one using the editor. Click "Show Details" to access the editor. Please consider sharing your model, for others to use, by'}),(0,l.jsxs)("ol",{className:"list-decimal list-inside mt-2",children:[(0,l.jsx)("li",{children:"Downloading it as a JSON file."}),(0,l.jsxs)("li",{children:["Uploading it to"," ",(0,l.jsx)("a",{href:"https://github.com/jmalm/power-bill-react/issues/1",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Contributed price models on GitHub"}),"."]})]}),(0,l.jsx)("h2",{className:"text-xl font-semibold mt-6 mb-4",children:"CSV file doesn't load correctly?"}),(0,l.jsx)("p",{className:"mb-4",children:"If you're having trouble loading your CSV file, please ensure that it follows the correct format:"}),(0,l.jsxs)("ul",{className:"list-disc list-inside mb-4",children:[(0,l.jsxs)("li",{children:["The first row should contain the headers:"," ",(0,l.jsx)("span",{style:{fontFamily:"monospace"},children:"timestamp"})," ","and"," ",(0,l.jsx)("span",{style:{fontFamily:"monospace"},children:"usage"}),"."]}),(0,l.jsxs)("li",{children:["Timestamps must be in"," ",(0,l.jsx)("span",{style:{fontFamily:"monospace"},children:"YYYY-MM-DD HH:MM"})," ","format."]}),(0,l.jsx)("li",{children:"Ensure there are no empty rows or columns in the CSV file."})]}),(0,l.jsxs)("p",{className:"mt-4",children:["If you would like the app to support your CSV file format, please open an issue on"," ",(0,l.jsx)("a",{href:"https://github.com/jmalm/power-bill-react/issues",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"GitHub"}),". Include a sample of your CSV file, and I will try to add support for it."]})]})})]}),(0,l.jsx)("footer",{className:"w-full text-center mt-12 p-4 text-gray-500 text-sm",children:(0,l.jsxs)("p",{children:["\xa9 2025"," ",(0,l.jsx)("a",{href:"https://github.com/jmalm",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Jakob Malm"}),". This project is open source and available on"," ",(0,l.jsx)("a",{href:"https://github.com/jmalm/power-bill-react",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"GitHub"}),"."]})})]})}},6819:(e,t,s)=>{Promise.resolve().then(s.bind(s,193))}},e=>{e.O(0,[441,964,358],()=>e(e.s=6819)),_N_E=e.O()}]);