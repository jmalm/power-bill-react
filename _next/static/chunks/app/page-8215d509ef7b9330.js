(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6819:(e,t,a)=>{Promise.resolve().then(a.bind(a,7200))},7200:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var n=a(5155),s=a(2115);function l(e){let{selectedModel:t,onModelChange:a,priceModels:s}=e;return(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{htmlFor:"price-model-select",className:"block text-sm font-medium text-gray-200 mb-2",children:"Select Price Model"}),(0,n.jsx)("select",{id:"price-model-select",value:t,onChange:e=>a(e.target.value),className:"block w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-white focus:ring-blue-500 focus:border-blue-500",children:s.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e.name))})]})}function r(e){let{model:t,onChange:a}=e,s=e=>{let{name:n,value:s,type:l,checked:r}=e.target,c=s;"number"===l&&(c=parseFloat(s)),"checkbox"===l&&(c=r),a({...t,[n]:c})};return(0,n.jsxs)("form",{className:"space-y-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Name"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"name",value:t.name,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Currency"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"currency",value:t.currency,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Tax Rate"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"taxRate",type:"number",value:t.vatRate,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Usage Tax Per kWh"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"usageTaxPerKWh",type:"number",value:t.usageTaxPerKWh,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Prices Include Tax"}),(0,n.jsx)("input",{type:"checkbox",name:"pricesIncludeTax",checked:t.pricesIncludeVat,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Fixed Fee Per Month"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"fixedFeePerMonth",type:"number",value:t.fixedFeePerMonth,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Usage Fee Per kWh"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"usageFeePerKWh",type:"number",value:t.usageFeePerKWh,onChange:s})]})]})}function c(e){return{name:e.name,feePerKW:e.fee_per_kw,numberOfTopPeaksToAverage:e.number_of_top_peaks_to_average,months:e.months,startTime:e.start_time,endTime:e.end_time}}async function i(){let e=await fetch("".concat("/power-bill-react","/price-models/models-index.json")),t=(await e.json()).models;return await Promise.all(t.map(async e=>{var t,a;let n=await fetch("/price-models/".concat(e));return{name:(t=await n.json()).name,currency:t.currency,vatRate:t.vat_rate,pricesIncludeVat:t.prices_include_tax,fixedFeePerMonth:t.fixed_fee_per_month,usageFeePerKWh:t.usage_fee_per_kwh,usageTaxPerKWh:t.usage_tax_per_kwh,powerTariffs:(null==(a=t.power_tariffs)?void 0:a.map(c))||[]}}))}function o(e){let{model:t,totalUsage:a,topHours:s}=e,l=t.pricesIncludeVat?1:1/(1+t.vatRate),r=t.fixedFeePerMonth*l,c=a*t.usageFeePerKWh*l,i=t.powerTariffs.map(e=>{let t=s[e.name]||0,a=t*e.feePerKW*l;return{name:e.name,avgTop:t,fee:a,feePerKW:e.feePerKW,n:e.numberOfTopPeaksToAverage}}),o=a*t.usageTaxPerKWh*l,d=r+c+i.reduce((e,t)=>e+t.fee,0)+o,u=d*t.vatRate,m=d+u;return(0,n.jsxs)("div",{className:"mt-8 p-4 bg-gray-900 rounded shadow text-white",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Cost Breakdown"}),(0,n.jsxs)("div",{className:"mb-2",children:["Fixed fee:"," ",(0,n.jsxs)("span",{className:"float-right",children:[r.toFixed(2)," ",t.currency]})]}),(0,n.jsxs)("div",{className:"mb-2",children:["Usage fee (",a.toFixed(2)," kWh \xd7 ",t.usageFeePerKWh," ",t.currency,"/kWh):"," ",(0,n.jsxs)("span",{className:"float-right",children:[c.toFixed(2)," ",t.currency]})]}),i.map(e=>(0,n.jsxs)("div",{className:"mb-2",children:[e.name," (",e.avgTop.toFixed(2)," kW \xd7 ",e.feePerKW," ",t.currency,"/kW):"," ",(0,n.jsxs)("span",{className:"float-right",children:[e.fee.toFixed(2)," ",t.currency]})]},e.name)),(0,n.jsxs)("div",{className:"mb-2",children:["Electricity tax (",a.toFixed(2)," kWh \xd7 ",t.usageTaxPerKWh," ",t.currency,"/kWh):"," ",(0,n.jsxs)("span",{className:"float-right",children:[o.toFixed(2)," ",t.currency]})]}),(0,n.jsxs)("div",{className:"mb-2",children:["VAT (",(100*t.vatRate).toFixed(1),"%):"," ",(0,n.jsxs)("span",{className:"float-right",children:[u.toFixed(2)," ",t.currency]})]}),(0,n.jsxs)("div",{className:"mt-4 font-bold text-lg",children:["Total:"," ",(0,n.jsxs)("span",{className:"float-right",children:[m.toFixed(2)," ",t.currency]})]})]})}function d(e){if(!e)return;let[t,a]=e.split(":").map(Number);return t+(a||0)/60}function u(){let[e,t]=(0,s.useState)("custom"),[a,c]=(0,s.useState)([]),u=a.find(t=>t.name===e)||null,[m,h]=(0,s.useState)(null),[x,f]=(0,s.useState)(!1),[p,b]=(0,s.useState)([]);(0,s.useEffect)(()=>{i().then(a=>{c(a),a.length>0&&!a.some(t=>t.name===e)&&t(a[0].name)})},[]),(0,s.useEffect)(()=>{h(u?{...u}:null)},[u]);let g=p.reduce((e,t)=>e+t.usage,0),j=u&&p.length?function(e,t){if(!e.length)return{};let a=function(e){let t={};return e.forEach(e=>{let{datetime:a,usage:n}=e,s=new Date(a);if(isNaN(s.getTime()))return;let l=s.toISOString().slice(0,10),r=s.getHours();t[l]||(t[l]={}),t[l][r]=(t[l][r]||0)+n}),t}(e),n={};for(let e of t.powerTariffs){let t=function(e,t){let a=[...e].sort((e,t)=>t-e).slice(0,t);return 0===a.length?0:a.reduce((e,t)=>e+t,0)/a.length}(function(e,t){let a=[];for(let s in e){var n;if(n=new Date(s),!(!t.months||0===t.months.length||t.months.includes(n.getMonth()+1)))continue;let l=function(e,t,a){let n=-1/0;for(let t=0;t<24;t++){if(!function(e,t){var a,n;if(!t.startTime||!t.endTime)return!0;let s=null!=(a=d(t.startTime))?a:0,l=null!=(n=d(t.endTime))?n:24;return s<l?e>=s&&e<l:e>=s||e<l}(t,a))continue;let s=e[t]||0;a.nightReduction&&function(e,t){if(!t)return!1;let a=d(t.startTime),n=d(t.endTime);return void 0!==a&&void 0!==n&&(a<=n?e>=a&&e<n:e>=a||e<n)}(t,a.nightReduction)&&(s*=a.nightReduction.factor),s>n&&(n=s)}return n>-1/0?n:0}(e[s],0,t);a.push(l)}return a}(a,e),e.numberOfTopPeaksToAverage);n[e.name]=t}return n}(p,u):{};return(0,n.jsx)("main",{className:"flex min-h-screen flex-col items-center p-24",children:(0,n.jsxs)("div",{className:"w-full max-w-lg",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"Calculate Electricity Cost"}),(0,n.jsx)(l,{selectedModel:e,onModelChange:t,priceModels:a}),(0,n.jsx)("button",{className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded",onClick:()=>f(e=>!e),children:x?"Hide Details":"Show Details"}),x&&m&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r,{model:m,onChange:e=>{h(e),c(t=>t.map(t=>t.name===e.name?e:t))}}),(0,n.jsx)("button",{className:"mt-4 px-4 py-2 bg-green-600 text-white rounded",onClick:()=>(function(e,t){let a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=t,s.click(),URL.revokeObjectURL(n)})(m,"".concat(m.name||"price-model",".json")),children:"Download as JSON"})]}),(0,n.jsxs)("div",{className:"mt-8",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"Upload usage CSV"}),(0,n.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>(function(e,t){var a;let n=null==(a=e.target.files)?void 0:a[0];if(!n)return;let s=new FileReader;s.onload=e=>{var a;t(function(e){let t=e.split(/\r?\n/),a=[];for(let e of t){if(!e.trim())continue;let t=e.match(/^([^;]+);([\d.,]*)$/);if(t){let e=t[2].replace(",",".");a.push({datetime:t[1],usage:parseFloat(e||"0")})}}return a}(null==(a=e.target)?void 0:a.result))},s.readAsText(n)})(e,b),className:"block"}),p.length>0&&(0,n.jsxs)("div",{className:"mt-2 text-sm text-green-400",children:["Loaded ",p.length," usage rows. Total:"," ",g.toFixed(2)," kWh"]})]}),u&&(0,n.jsx)(o,{model:u,totalUsage:g,topHours:j})]})})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=6819)),_N_E=e.O()}]);