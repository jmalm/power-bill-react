(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3532:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var n=s(5155),a=s(2115);function r(e){let{selectedModel:t,onModelChange:s,priceModels:a}=e;return(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{htmlFor:"price-model-select",className:"block text-sm font-medium text-gray-200 mb-2",children:"Select Price Model"}),(0,n.jsx)("select",{id:"price-model-select",value:t,onChange:e=>s(e.target.value),className:"block w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-white focus:ring-blue-500 focus:border-blue-500",children:a.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e.name))})]})}function i(e){var t;let{tariff:s,onChange:a}=e,r=e=>{let{name:t,value:n,type:r,checked:i}=e.target,l=n;"number"===r&&(l=parseFloat(n)),"checkbox"===r&&(l=i),a({...s,[t]:l})};return(0,n.jsxs)("div",{className:"space-y-2 border p-2 rounded",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Tariff Name"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"name",value:s.name,onChange:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Fee Per KW"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"feePerKW",type:"number",value:s.feePerKW,onChange:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Number of Top Peaks to Average"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"numberOfTopPeaksToAverage",type:"number",value:s.numberOfTopPeaksToAverage,onChange:r})]}),(0,n.jsx)("h4",{className:"text-md font-semibold mt-2",children:"Time Limits (Optional)"}),s.timeLimits?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Start Time"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"startTime",type:"time",value:s.timeLimits.startTime,onChange:e=>{a({...s,timeLimits:{...s.timeLimits,startTime:e.target.value}})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"End Time"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"endTime",type:"time",value:s.timeLimits.endTime,onChange:e=>{a({...s,timeLimits:{...s.timeLimits,endTime:e.target.value}})}}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Months (0-11, comma-separated)"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"months",value:null==(t=s.timeLimits.months)?void 0:t.join(","),onChange:e=>{let t=e.target.value.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e));a({...s,timeLimits:{...s.timeLimits,months:t}})}})]})]}),(0,n.jsx)("button",{type:"button",onClick:()=>a({...s,timeLimits:void 0}),className:"mt-2 bg-red-500 text-white p-2 rounded hover:bg-red-600",children:"Remove Time Limits"})]}):(0,n.jsx)("button",{type:"button",onClick:()=>a({...s,timeLimits:{startTime:"00:00",endTime:"23:59",months:[]}}),className:"mt-2 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"Add Time Limits"}),(0,n.jsx)("h4",{className:"text-md font-semibold mt-2",children:"Night Reduction (Optional)"}),s.reduction?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Reduction Factor"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"nightReduction.factor",type:"number",step:"0.01",value:s.reduction.factor,onChange:e=>{let t=parseFloat(e.target.value);a({...s,reduction:{...s.reduction,factor:isNaN(t)?0:t}})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Reduction Start Time"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"nightReduction.startTime",type:"time",value:s.reduction.startTime,onChange:e=>{a({...s,reduction:{...s.reduction,startTime:e.target.value}})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Reduction End Time"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"nightReduction.endTime",type:"time",value:s.reduction.endTime,onChange:e=>{a({...s,reduction:{...s.reduction,endTime:e.target.value}})}})]}),(0,n.jsx)("button",{type:"button",onClick:()=>a({...s,reduction:void 0}),className:"mt-2 bg-red-500 text-white p-2 rounded hover:bg-red-600",children:"Remove Night Reduction"})]}):(0,n.jsx)("button",{type:"button",onClick:()=>a({...s,reduction:{factor:.5,startTime:"22:00",endTime:"08:00"}}),className:"mt-2 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"Add Night Reduction"})]})}class l{constructor(e,t,s=2,n=[],a="00:00",r="23:59",i){this.name=e,this.feePerKW=t,this.numberOfTopPeaksToAverage=s,this.months=n,this.startTime=a,this.endTime=r,this.reduction=i}}function o(e){let{model:t,onChange:s}=e,a=e=>{let{name:n,value:a,type:r,checked:i}=e.target,l=a;"number"===r&&(l=parseFloat(a)),"checkbox"===r&&(l=i),s({...t,[n]:l})};return(0,n.jsxs)("form",{className:"space-y-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Name"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"name",value:t.name,onChange:a})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Currency"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"currency",value:t.currency,onChange:a})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Tax Rate"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"taxRate",type:"number",value:t.vatRate,onChange:a})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Usage Tax Per kWh"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"usageTaxPerKWh",type:"number",value:t.usageTaxPerKWh,onChange:a})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Prices Include Tax"}),(0,n.jsx)("input",{type:"checkbox",name:"pricesIncludeTax",checked:t.pricesIncludeVat,onChange:a})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Fixed Fee Per Month"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"fixedFeePerMonth",type:"number",value:t.fixedFeePerMonth,onChange:a})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm",children:"Usage Fee Per kWh"}),(0,n.jsx)("input",{className:"block w-full p-2 border rounded",name:"usageFeePerKWh",type:"number",value:t.usageFeePerKWh,onChange:a})]})," ",(0,n.jsx)("h3",{className:"text-lg font-semibold mt-4",children:"Power Tariffs"}),t.powerTariffs.map((e,a)=>(0,n.jsxs)("div",{className:"border p-2 rounded mt-2",children:[(0,n.jsx)(i,{tariff:e,onChange:e=>{let n=[...t.powerTariffs];n[a]=e,s({...t,powerTariffs:n})}}),(0,n.jsx)("button",{type:"button",onClick:()=>{let e=t.powerTariffs.filter((e,t)=>t!==a);s({...t,powerTariffs:e})},className:"mt-2 bg-red-500 text-white p-2 rounded hover:bg-red-600",children:"Remove Tariff"})]},a)),(0,n.jsx)("button",{type:"button",onClick:()=>{let e=[...t.powerTariffs,new l("New tariff",0)];s({...t,powerTariffs:e})},className:"mt-4 bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"Add New Tariff"})]})}function c(e){var t,s;return{name:e.name,feePerKW:e.fee_per_kw,numberOfTopPeaksToAverage:e.number_of_top_peaks_to_average,timeLimits:e.time_limits?{startTime:(t=e.time_limits).start_time,endTime:t.end_time,months:t.months}:void 0,reduction:e.reduction?{startTime:(s=e.reduction).start_time,endTime:s.end_time,factor:s.factor}:void 0}}async function m(){let e="/power-bill-react",t=await fetch("".concat(e,"/price-models/models-index.json")),s=(await t.json()).models;return await Promise.all(s.map(async t=>{var s,n;let a=await fetch("".concat(e,"/price-models/").concat(t));return{name:(s=await a.json()).name,currency:s.currency,vatRate:s.vat_rate,pricesIncludeVat:s.prices_include_tax,fixedFeePerMonth:s.fixed_fee_per_month,usageFeePerKWh:s.usage_fee_per_kwh,usageTaxPerKWh:s.usage_tax_per_kwh,powerTariffs:(null==(n=s.power_tariffs)?void 0:n.map(c))||[]}}))}function d(e){let{model:t,totalUsage:s,topHours:a}=e,r=t.pricesIncludeVat?1:1/(1+t.vatRate),i=t.fixedFeePerMonth*r,l=s*t.usageFeePerKWh*r,o=t.powerTariffs.map(e=>{let t=a[e.name]||0,s=t*e.feePerKW*r;return{name:e.name,avgTop:t,fee:s,feePerKW:e.feePerKW,n:e.numberOfTopPeaksToAverage}}),c=s*t.usageTaxPerKWh*r,m=i+l+o.reduce((e,t)=>e+t.fee,0)+c,d=m*t.vatRate,u=m+d;return(0,n.jsxs)("div",{className:"mt-8 p-4 bg-gray-900 rounded shadow text-white",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Cost Breakdown"}),(0,n.jsxs)("div",{className:"mb-2",children:["Fixed fee:"," ",(0,n.jsxs)("span",{className:"float-right",children:[i.toFixed(2)," ",t.currency]})]}),(0,n.jsxs)("div",{className:"mb-2",children:["Usage fee (",s.toFixed(2)," kWh \xd7 ",t.usageFeePerKWh," ",t.currency,"/kWh):"," ",(0,n.jsxs)("span",{className:"float-right",children:[l.toFixed(2)," ",t.currency]})]}),o.map(e=>(0,n.jsxs)("div",{className:"mb-2",children:[e.name," (",e.avgTop.toFixed(2)," kW \xd7 ",e.feePerKW," ",t.currency,"/kW):"," ",(0,n.jsxs)("span",{className:"float-right",children:[e.fee.toFixed(2)," ",t.currency]})]},e.name)),(0,n.jsxs)("div",{className:"mb-2",children:["Electricity tax (",s.toFixed(2)," kWh \xd7 ",t.usageTaxPerKWh," ",t.currency,"/kWh):"," ",(0,n.jsxs)("span",{className:"float-right",children:[c.toFixed(2)," ",t.currency]})]}),(0,n.jsxs)("div",{className:"mb-2",children:["VAT (",(100*t.vatRate).toFixed(1),"%):"," ",(0,n.jsxs)("span",{className:"float-right",children:[d.toFixed(2)," ",t.currency]})]}),(0,n.jsxs)("div",{className:"mt-4 font-bold text-lg",children:["Total:"," ",(0,n.jsxs)("span",{className:"float-right",children:[u.toFixed(2)," ",t.currency]})]})]})}function u(e){if(!e)return;let[t,s]=e.split(":").map(Number);return t+(s||0)/60}function h(){let[e,t]=(0,a.useState)("custom"),[s,i]=(0,a.useState)([]),l=s.find(t=>t.name===e)||null,[c,h]=(0,a.useState)(null),[x,f]=(0,a.useState)(!1),[b,p]=(0,a.useState)([]);(0,a.useEffect)(()=>{m().then(s=>{i(s),s.length>0&&!s.some(t=>t.name===e)&&t(s[0].name)})},[]),(0,a.useEffect)(()=>{h(l?{...l}:null)},[l]);let g=b.reduce((e,t)=>e+t.usage,0),j=l&&b.length?function(e,t){if(!e.length)return{};let s=function(e){let t={};return e.forEach(e=>{let{datetime:s,usage:n}=e,a=new Date(s);if(isNaN(a.getTime()))return;let r=a.toISOString().slice(0,10),i=a.getHours();t[r]||(t[r]={}),t[r][i]=(t[r][i]||0)+n}),t}(e),n={};for(let e of t.powerTariffs){let t=function(e,t){let s=[...e].sort((e,t)=>t-e).slice(0,t);return 0===s.length?0:s.reduce((e,t)=>e+t,0)/s.length}(function(e,t){let s=[];for(let n in e){if(!function(e,t){var s;return null==(s=t.timeLimits)||!s.months||0===t.timeLimits.months.length||t.timeLimits.months.includes(e.getMonth()+1)}(new Date(n),t))continue;let a=function(e,t,s){let n=-1/0;for(let t=0;t<24;t++){if(!function(e,t){var s,n;if(!t.timeLimits||!t.timeLimits.startTime||!t.timeLimits.endTime)return!0;let a=null!=(s=u(t.timeLimits.startTime))?s:0,r=null!=(n=u(t.timeLimits.endTime))?n:24;return a<r?e>=a&&e<r:e>=a||e<r}(t,s))continue;let a=e[t]||0;s.reduction&&function(e,t){if(!t)return!1;let s=u(t.startTime),n=u(t.endTime);return void 0!==s&&void 0!==n&&(s<=n?e>=s&&e<n:e>=s||e<n)}(t,s.reduction)&&(a*=s.reduction.factor),a>n&&(n=a)}return n>-1/0?n:0}(e[n],0,t);s.push(a)}return s}(s,e),e.numberOfTopPeaksToAverage);n[e.name]=t}return n}(b,l):{};return(0,n.jsx)("main",{className:"flex min-h-screen flex-col items-center p-24",children:(0,n.jsxs)("div",{className:"w-full max-w-lg",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"Calculate Electricity Cost"}),(0,n.jsx)(r,{selectedModel:e,onModelChange:t,priceModels:s}),(0,n.jsx)("button",{className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded",onClick:()=>f(e=>!e),children:x?"Hide Details":"Show Details"}),x&&c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o,{model:c,onChange:e=>{h(e),i(t=>t.map(t=>t.name===e.name?e:t))}}),(0,n.jsx)("button",{className:"mt-4 px-4 py-2 bg-green-600 text-white rounded",onClick:()=>(function(e,t){let s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download=t,a.click(),URL.revokeObjectURL(n)})(c,"".concat(c.name||"price-model",".json")),children:"Download as JSON"})]}),(0,n.jsxs)("div",{className:"mt-8",children:[(0,n.jsx)("label",{className:"block mb-2 font-medium",children:"Upload usage CSV"}),(0,n.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>(function(e,t){var s;let n=null==(s=e.target.files)?void 0:s[0];if(!n)return;let a=new FileReader;a.onload=e=>{var s;t(function(e){let t=e.split(/\r?\n/),s=[];for(let e of t){if(!e.trim())continue;let t=e.match(/^([^;]+);([\d.,]*)$/);if(t){let e=t[2].replace(",",".");s.push({datetime:t[1],usage:parseFloat(e||"0")})}}return s}(null==(s=e.target)?void 0:s.result))},a.readAsText(n)})(e,p),className:"block"}),b.length>0&&(0,n.jsxs)("div",{className:"mt-2 text-sm text-green-400",children:["Loaded ",b.length," usage rows. Total:"," ",g.toFixed(2)," kWh"]})]}),l&&(0,n.jsx)(d,{model:l,totalUsage:g,topHours:j})]})})}},6819:(e,t,s)=>{Promise.resolve().then(s.bind(s,3532))}},e=>{e.O(0,[441,964,358],()=>e(e.s=6819)),_N_E=e.O()}]);